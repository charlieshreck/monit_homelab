---
apiVersion: v1
kind: ConfigMap
metadata:
  name: gatus-config
  namespace: monitoring
data:
  config.yaml: |
    storage:
      type: sqlite
      path: /data/data.db

    metrics: true

    ui:
      title: "Homelab Status"
      header: "Monitoring Dashboard"

    endpoints:
      # Infrastructure
      - name: Proxmox Ruapehu (Production)
        group: Infrastructure
        url: "https://10.10.0.10:8006"
        interval: 120s
        conditions:
          - "[STATUS] == 200"
        client:
          insecure: true

      - name: Proxmox Carrick (Monitoring)
        group: Infrastructure
        url: "https://10.30.0.10:8006"
        interval: 120s
        conditions:
          - "[STATUS] == 200"
        client:
          insecure: true

      - name: Production Talos Cluster
        group: Infrastructure
        url: "https://10.10.0.40:6443"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
        client:
          insecure: true

      - name: Monitoring K3s Cluster
        group: Infrastructure
        url: "https://10.30.0.20:6443"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
        client:
          insecure: true

      - name: Production Traefik
        group: Infrastructure
        url: "http://10.10.0.90:80"
        interval: 60s
        conditions:
          - "[STATUS] == 404"

      # Monitoring Stack
      - name: Grafana
        group: Monitoring
        url: "https://grafana.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: Prometheus
        group: Monitoring
        url: "https://prometheus.kernow.io/-/healthy"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: Alertmanager
        group: Monitoring
        url: "https://alertmanager.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: VictoriaMetrics
        group: Monitoring
        url: "https://victoriametrics.kernow.io/health"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: VictoriaLogs
        group: Monitoring
        url: "https://victorialogs.kernow.io/health"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: Gatus (This)
        group: Monitoring
        url: "https://gatus.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: Beszel
        group: Monitoring
        url: "https://beszel.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      # Core Applications
      - name: Homepage
        group: Apps
        url: "https://homepage.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: ArgoCD
        group: Apps
        url: "https://argocd.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: Vaultwarden
        group: Apps
        url: "https://vaultwarden.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: FileBrowser
        group: Apps
        url: "https://files.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: Termix
        group: Apps
        url: "https://termix.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      # Home Automation
      - name: Home Assistant
        group: Home Automation
        url: "https://homeassistant.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: Matter Hub
        group: Home Automation
        url: "https://matter-hub.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: TasmoAdmin
        group: Home Automation
        url: "https://tasmoadmin.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      # Media Stack
      - name: Overseerr
        group: Media
        url: "https://overseerr.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      - name: Radarr
        group: Media
        url: "https://radarr.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      - name: Sonarr
        group: Media
        url: "https://sonarr.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      - name: Prowlarr
        group: Media
        url: "https://prowlarr.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      - name: SABnzbd
        group: Media
        url: "https://sabnzbd.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      - name: Transmission
        group: Media
        url: "https://transmission.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      - name: Tautulli
        group: Media
        url: "https://tautulli.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      - name: Cleanuparr
        group: Media
        url: "https://cleanuparr.kernow.io"
        interval: 120s
        conditions:
          - "[STATUS] == 200"

      # Notes Apps
      - name: GlassKeep
        group: Notes
        url: "https://glasskeep.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: KaraKeep
        group: Notes
        url: "https://karakeep.kernow.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: gatus-data
  namespace: monitoring
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gatus
  namespace: monitoring
  labels:
    app: gatus
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gatus
  template:
    metadata:
      labels:
        app: gatus
    spec:
      containers:
        - name: gatus
          image: twinproduction/gatus:latest
          ports:
            - name: web
              containerPort: 8080
              protocol: TCP
          volumeMounts:
            - name: config
              mountPath: /config
            - name: data
              mountPath: /data
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi
      volumes:
        - name: config
          configMap:
            name: gatus-config
        - name: data
          persistentVolumeClaim:
            claimName: gatus-data
---
apiVersion: v1
kind: Service
metadata:
  name: gatus
  namespace: monitoring
spec:
  selector:
    app: gatus
  ports:
    - name: web
      protocol: TCP
      port: 8080
      targetPort: 8080
  type: ClusterIP
