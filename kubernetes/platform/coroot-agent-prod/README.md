# Coroot Agent - Production Cluster

Deploys Coroot monitoring agents to the **prod_homelab** cluster to collect metrics and send them to the centralized Coroot server on monit_homelab.

## Architecture

- **Cluster Agent**: Collects Kubernetes state metrics (deployments, pods, services, etc.)
- **Node Agent**: eBPF-based agent collecting host and application metrics, logs, traces, and profiles

## Configuration

- **Coroot Server**: http://10.30.0.90:8080 (on monit_homelab cluster)
- **API Key**: Stored in secret `coroot-api-key` (auto-generated by Coroot operator)
- **Project**: `prod-homelab` in Coroot UI

## Deployment

This is deployed automatically by ArgoCD:

```bash
# Check ArgoCD application status
kubectl get application coroot-agent-prod -n argocd

# Check deployed resources
export KUBECONFIG=/home/prod_homelab/infrastructure/terraform/generated/kubeconfig
kubectl get pods -n coroot-agent
```

## Network Requirements

The prod_homelab cluster must be able to reach:
- `10.30.0.90:8080` - Coroot server HTTP API

## Permissions

The node-agent requires privileged access to:
- Host PID namespace (`hostPID: true`)
- eBPF kernel features (`/sys/kernel/tracing`, `/sys/kernel/debug`)
- cgroup filesystem (`/sys/fs/cgroup`)

The namespace has `pod-security.kubernetes.io/enforce: privileged` to allow these requirements.
