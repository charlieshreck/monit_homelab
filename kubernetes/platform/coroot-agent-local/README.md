# Coroot Agent - Monitoring Cluster

Deploys Coroot monitoring agents to the **monit_homelab** cluster (where Coroot server runs) to collect metrics about the monitoring infrastructure itself.

## Architecture

- **Cluster Agent**: Collects Kubernetes state metrics (deployments, pods, services, etc.)
- **Node Agent**: eBPF-based agent collecting host and application metrics, logs, traces, and profiles

## Configuration

- **Coroot Server**: http://coroot-coroot.coroot.svc.cluster.local:8080 (in-cluster service)
- **API Key**: Stored in secret `coroot-api-key` (auto-generated by Coroot operator)
- **Project**: `monit-homelab` in Coroot UI

## Deployment

This is deployed automatically by ArgoCD:

```bash
# Check ArgoCD application status
kubectl get application coroot-agent-local -n argocd

# Check deployed resources
export KUBECONFIG=/home/monit_homelab/terraform/talos-single-node/generated/kubeconfig
kubectl get pods -n coroot-agent
```

## Network Requirements

The agents communicate with the Coroot server via the in-cluster service, so no external network access is required.

## Permissions

The node-agent requires privileged access to:
- Host PID namespace (`hostPID: true`)
- eBPF kernel features (`/sys/kernel/tracing`, `/sys/kernel/debug`)
- cgroup filesystem (`/sys/fs/cgroup`)

The namespace has `pod-security.kubernetes.io/enforce: privileged` to allow these requirements.
